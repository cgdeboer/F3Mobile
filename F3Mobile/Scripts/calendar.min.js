define(["jquery","toastr","moment","text!templates/currentweekitem.html","mustache","underscore"],function(n,t,i,r,u,f){function p(t){o=t.client_id;b();n("#authorize-button").on("click",function(){return gapi.auth.authorize({client_id:o,scope:s,immediate:!1},a),!1});n("#logout-button").on("click",function(){gapi.auth.signOut();n.ajax({url:"https://accounts.google.com/o/oauth2/revoke?token="+h,type:"get",dataType:"jsonp"}).success(function(){document.location.reload()})})}function w(n){var u=i(),t=i().startOf("week"),r=i().endOf("week");return n.isBetween(t,r)}function b(){e("checkAuth");try{gapi.auth.authorize({client_id:o,scope:s,immediate:!0},a)}catch(n){e("auth call failed: "+n.message)}}function a(n){var t=document.getElementById("authorize-div");n&&!n.error?(t.style.display="none",h=n.access_token,k(),v(!0)):(v(!1),t.style.display="inline")}function v(t){n("#logout-div").toggle(t)}function k(){e("load calendar");gapi.client.load("calendar","v3",nt)}function d(){var t=f.sortBy(l,"name");n.each(t,function(t,r){var e=n("#itemHolder"),u,f;e.append("<div><p class='lead'>"+r.summary+"<\/p><\/div>");u="<ul class='list-group'>";f={name:r.name,description:"",date:{}};n.each(r.items,function(n,t){var e=t.start.date==null?i(t.start.dateTime):i(t.start.date),o;w(e)&&(f={name:r.name,description:t.summary,date:e.format("MM/DD/YYYY")},c.push(f));o=i(t.start.date!=null?t.start.date:t.start.dateTime);u+='<li class="list-group-item">'+o.format("MM/DD/YYYY")+" - "+t.summary+"<\/li>"});u+="<\/ul>";e.append(u)});g()}function g(){var t=f.sortBy(c,"date");n.each(t,function(t,i){var f=u.to_html(r,i);n("#currentWeekItems").append(f)})}function e(n){console&&console.log&&console.log(n)}function nt(){var t=[];n.each(y,function(i,r){var u=n.Deferred();t.push(u);tt(r,function(){u.resolve()})});n.when.apply(this,t).done(function(){d();e("all done")})}function tt(n,t){var r=gapi.client.calendar.events.list({calendarId:n.id,timeMin:i().startOf("week").toISOString(),showDeleted:!1,singleEvents:!0,maxResults:10,orderBy:"startTime"});r.execute(function(i){e("get: "+n.name);l.push({summary:i.summary,name:n.name,items:i.items});t()})}var s=["https://www.googleapis.com/auth/calendar.readonly"],y=[{name:"Bagpipe",id:"l5jvg6rn8d1bpcqg76l14hoq7o@group.calendar.google.com"},{name:"Stonehenge",id:"1gb26eve59nn0ipbpn33ud9tk8@group.calendar.google.com"},{name:"The Brave",id:"um2l72805ggd9nqoq411nf6p50@group.calendar.google.com"},{name:"The Maul",id:"sn0n3fk13inesa7cju33fpejg4@group.calendar.google.com"},{name:"The Foxhole",id:"foxholef3@gmail.com"}],h="",o="",c=[],l=[];return jQuery.when.all===undefined&&(jQuery.when.all=function(t){var i=new jQuery.Deferred;return n.when.apply(jQuery,t).then(function(){i.resolve(Array.prototype.slice.call(arguments))},function(){i.fail(Array.prototype.slice.call(arguments))}),i}),{initialize:p}});
//# sourceMappingURL=calendar.min.js.map
